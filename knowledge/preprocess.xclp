/* preprocessing rules for vectorization */

include "vrg-sugar.xclp"

module Vectorize.

#?alpha, #?beta, meet(?alpha, ?beta, ?l)
=> ?alpha [~//] ?beta, ?l [on] ?alpha, ?l [on] ?beta.

\?l, \?m, meet(?l, ?m, ?)
=>
    ?alpha := gensym(), #?alpha,
    ?l [on] ?alpha, ?m [on] ?alpha,
    ?l [~//] ?m.

\?a, #?A, meet(?a, ?A, ?) => ?a [~//] ?A, ?a [~on] ?A.

\?l, #?alpha, \?m, project(?l, ?alpha, ?m)
=>
    ?theta := gensym(), #?theta,
    ?l [X] ?alpha, ?l [on] ?theta,
    meet(?theta, ?alpha, ?m),
    ?theta [T] ?alpha.
