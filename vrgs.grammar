program : item(s) proposition eofile

    { "include \"vrg-sugar.h\"\n\n" . join "", @{ $item[1] }, $item[2] }

eofile : /^\Z/

item : declaration
     | comment

comment : '#' /([^\n]+)/  { "/* $item[2] */\n" }

declaration : declarator <commit> variable_list ';' ws

              { my $prefix = $item{declarator};
                (join ", ", map { $prefix . $_ } @{ $item{variable_list} })
                    . ".\n";
              }

            | <error?> <reject>

declarator : 'line'   { '\\' }
           | 'plane'  { '#'  }
           | 'point'
           | <error>

variable_list : <leftop: variable ',' variable>
              | <error>

variable : /[A-Za-z]\w*/

ws: /[\n\s]*/

proposition : facts '=>' <commit> goal /;?/  { "$item{facts}.\ngoal($item{goal}).\n" }
            | <error?> <reject>

facts : <leftop: fact ',' fact>  { join ", ", @{ $item[1] }; }
      | <error>

fact : variable infix <commit> variable  { "$item[1] [$item{infix}] $item[4]" }
     | predicate
     | <error?> <reject>

goal : fact

infix : '//'
      | 'T'
      | 'X'
      | 'on'
      | '~//'
      | '~T'
      | '~X'
      | '~on'
      | <error>

predicate : predicate_name <commit> '(' variable_list ')'

            { "$item{predicate_name}(" .
              join(", ", @{ $item{variable_list} }) . ")" }
    
          | <error?> <reject>

predicate_name : 'meet'
               | 'project'
               | /\w+/ <error: "known predicate $item[1]">
